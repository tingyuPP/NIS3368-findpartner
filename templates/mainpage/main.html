{% load static %}
<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>笔记详情</title>
        <link rel="stylesheet" href="{% static 'css/main.css'%}" />
        <link rel="stylesheet" href="{% static 'css/pushbutton.css'%}" />
        <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" />
    </head>

    <body>
        <div class="note-detail-mask">
            <div class="note-container">
                <div class="media-container">
                    <div class="carousel">
                        <div class="carousel-item">
                            <img src="{{ post.image }}" alt="图片" />
                        </div>
                    </div>
                </div>
                <div class="interaction-container">
                    <div class="author-container">
                        <div class="author-me">
                            <div class="info">
                                <a href="/my/{{ author.id }}/">
                                    <img
                                        class="avatar-item"
                                        src="{{ author.image }}"
                                        alt="头像"
                                    />
                                </a>
                                <span class="name">{{ author.nickname }}</span>
                            </div>
                        </div>
                        <div class="note-scroller">
                            <div class="note-content">
                                <div class="title">{{ post.title }}</div>
                                <div class="desc">
                                    <span>{{ post.description }} <br /></span>
                                    {% for tag in post.tag %}
                                    <a class="tag tag-search">#{{ tag }}</a>
                                    {% endfor %}
                                </div>
                                <div class="bottom-container">
                                    <span class="date">{{ post.time }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <a
                        href="javascript:;"
                        class="invite-button"
                        onclick="sendmyinvitation()"
                        >发送邀请</a
                    >
                    <button class="disable-button">
                        <svg class="delete-svgIcon" viewBox="0 0 448 512">
                            <path
                                d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"
                            ></path>
                        </svg>
                    </button>
                    <button class="list-button" onclick="viewApplyList()">查看申请列表</button>
                </div>
            </div>
            <div class="close-cricle" onclick="closeNoteDetail()">
                <div class="close close-mask-white">
                    <span class="close-icon">✖️</span>
                </div>
            </div>
        </div>
    </body>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const isMyself = {{ is_myself|yesno:"true,false" }};
            console.log(isMyself);
            if (isMyself) {
                document.querySelector(".invite-button").style.display = "none";
            } else {
                document.querySelector(".disable-button").style.display = "none";
                document.querySelector(".list-button").style.display = "none";
            }
        });

        function viewApplyList() {
              // 更新浏览器地址栏
            history.pushState(null, null, `/applylist/{{ post.id }}/`);

             //刷新页面
            location.reload();
        }

        function closeNoteDetail() {
            history.back();
        }
        window.addEventListener("popstate", function (event) {
            location.reload(); // 刷新页面
        });
        function sendmyinvitation() {
            const noticeId = "{{ post.id }}"; // 替换为实际的notice_id

            fetch("/api/request_notice", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ notice_id: noticeId }),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success === 0) {
                        alert("请求成功");
                    } else if (data.success === -1) {
                        alert("用户不存在");
                    } else if (data.success === -2) {
                        alert("需求不存在");
                    } else {
                        alert("请求失败");
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
        }
    </script>
</html>
